<script type="text/javascript">
    function subscribe(subscribe, lesson_id, filter) {
        $.ajax({
            type:"GET",
            url:"/lessons/subscriptions",
            data:{  
                subscribe: subscribe,
                lesson_id: lesson_id,
            },
            success: function(json_response){
                if (json_response['subscription_status'] == 'unsubscribed') {
                    // Unsub button
                    $('#unsubscribe_lesson_button_id_'+lesson_id).hide();
                    // Sub button
                    $('#subscribe_lesson_button_id_'+lesson_id).removeAttr('hidden');
                    $('#subscribe_lesson_button_id_'+lesson_id).show();
                    // Start Lesson button
                    $('#start_lesson_button_id_'+lesson_id).hide();
                    if (filter == 'mylessons') {
                        $('#'+lesson_id).remove();
                    }
                } else if (json_response['subscription_status'] == 'subscribed') {
                    // Unsub button
                    $('#unsubscribe_lesson_button_id_'+lesson_id).removeAttr('hidden');
                    $('#unsubscribe_lesson_button_id_'+lesson_id).show();
                    // Sub button
                    $('#subscribe_lesson_button_id_'+lesson_id).hide();
                    // Start Lesson button
                    $('#start_lesson_button_id_'+lesson_id).removeAttr('hidden');
                    $('#start_lesson_button_id_'+lesson_id).show();
                }
            }
        })
    }

    function add_to_basket(lesson_id) {
        let csrfToken = "{{ csrf_token }}";
        event.preventDefault();
        $.ajax({
            type:"POST",
            url:"/basket/add_to_basket/",
            data:{  
                'csrfmiddlewaretoken': csrfToken,
                lesson_id: lesson_id,
            },
            success: function(json_response){
                if (json_response['item_added'] == 'True'){
                    let count = String($('#nav-cart-amount').text());
                    count = count.replace('+', '');
                    count = parseInt(count);
                    if (Number.isNaN(count)) {
                        count = 1;
                    } else {
                        count = count + 1;
                    }
                    $('#nav-cart-amount').text('+'+count);
                }
            }
        })
    }

</script>